<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DeepNet Social - AI Research Community</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; background-color: #18191a; color: #e4e6ea; line-height: 1.34; }

    /* Login Modal */
    .login-modal { position: fixed; inset: 0; background: rgba(0,0,0,.8); display: flex; justify-content: center; align-items: center; z-index: 2000; }
    .login-content { background: #242526; border-radius: 12px; padding: 32px; width: 400px; max-width: 90%; position: relative; }
    .login-header { text-align: center; margin-bottom: 24px; }
    .login-logo { font-size: 32px; font-weight: bold; color: #1877f2; margin-bottom: 8px; }
    .login-subtitle { color: #b0b3b8; font-size: 16px; }
    .modal-close { position: absolute; top: 16px; right: 20px; font-size: 24px; font-weight: bold; color: #b0b3b8; cursor: pointer; background: none; border: none; padding: 4px; }
    .modal-close:hover { color: #e4e6ea; }
    .auth-tabs { display: flex; margin-bottom: 20px; background: #3a3b3c; border-radius: 8px; padding: 4px; }
    .auth-tab { flex: 1; background: none; border: none; padding: 12px; color: #b0b3b8; cursor: pointer; border-radius: 6px; font-weight: 600; transition: .2s; }
    .auth-tab.active { background: #1877f2; color: #fff; }
    .auth-form { display: block; }
    .auth-form.hidden { display: none; }
    .form-group { margin-bottom: 16px; }
    .form-input { width: 100%; padding: 14px 16px; background: #3a3b3c; border: 1px solid #3e4042; border-radius: 8px; color: #e4e6ea; font-size: 16px; }
    .form-input:focus { outline: none; border-color: #1877f2; }
    .form-input::placeholder { color: #b0b3b8; }
    .auth-btn { width: 100%; padding: 14px; background: #1877f2; border: none; border-radius: 8px; color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; transition: .2s; }
    .auth-btn:hover { background: #166fe5; }
    .auth-message { margin-top: 12px; padding: 8px; border-radius: 6px; font-size: 14px; text-align: center; }
    .auth-message.success { background: rgba(24,119,242,.2); color: #1877f2; }
    .auth-message.error { background: rgba(244,67,54,.2); color: #f44336; }

    /* Header */
    .header { background: #242526; border-bottom: 1px solid #3e4042; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; height: 60px; }
    .header-content { display: flex; align-items: center; justify-content: space-between; max-width: 1200px; margin: 0 auto; padding: 0 16px; height: 100%; }
    .logo { display: flex; align-items: center; gap: 8px; font-size: 24px; font-weight: bold; color: #1877f2; text-decoration: none; }
    .search-bar { flex: 1; max-width: 320px; margin: 0 16px; }
    .search-input { width: 100%; background: #3a3b3c; border: none; border-radius: 50px; padding: 10px 16px; color: #e4e6ea; font-size: 15px; }
    .search-input::placeholder { color: #b0b3b8; }
    .header-nav { display: flex; gap: 8px; }
    .nav-item { padding: 12px 16px; border-radius: 8px; color: #b0b3b8; text-decoration: none; transition: .2s; font-weight: 600; }
    .nav-item:hover, .nav-item.active { background: #3a3b3c; color: #1877f2; }
    .header-actions { display: flex; align-items: center; gap: 8px; }
    .icon-btn { width: 40px; height: 40px; background: #3a3b3c; border: none; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #e4e6ea; cursor: pointer; font-size: 16px; transition: .2s; }
    .icon-btn:hover { background: #4e4f50; }
    .user-avatar { width: 32px; height: 32px; border-radius: 50%; cursor: pointer; object-fit: cover; }
    .logout-btn { background: #e74c3c; color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: .2s; }
    .logout-btn:hover { background: #c0392b; }

    /* Main Layout */
    .main-container { margin-top: 60px; display: flex; max-width: 1200px; margin-left: auto; margin-right: auto; gap: 20px; padding: 20px 16px; }

    /* Left Sidebar */
    .left-sidebar { width: 280px; position: sticky; top: 80px; height: calc(100vh - 80px); overflow-y: auto; }
    .sidebar-item { display: flex; align-items: center; padding: 8px; border-radius: 8px; color: #e4e6ea; text-decoration: none; transition: .2s; margin-bottom: 4px; }
    .sidebar-item:hover { background: #3a3b3c; }
    .sidebar-icon { width: 36px; height: 36px; margin-right: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; border-radius: 50%; background: #3a3b3c; }
    .sidebar-text { font-weight: 500; }

    /* Main Feed */
    .main-feed { flex: 1; max-width: 560px; }
    .card { background: #242526; border-radius: 8px; padding: 16px; margin-bottom: 16px; border: 1px solid #3e4042; }

    /* Post Composer */
    .post-composer { margin-bottom: 20px; }
    .composer-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
    .composer-input { background: #3a3b3c; border: none; border-radius: 24px; padding: 12px 16px; color: #e4e6ea; font-size: 16px; width: 100%; resize: none; min-height: 44px; font-family: inherit; }
    .composer-input::placeholder { color: #b0b3b8; }
    .composer-input:focus { outline: none; border: 2px solid #1877f2; }
    .composer-tools { display: flex; justify-content: space-between; align-items: center; margin-top: 16px; padding-top: 12px; border-top: 1px solid #3e4042; }
    .composer-options { display: flex; gap: 8px; }
    .composer-btn { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: none; border: none; border-radius: 6px; color: #b0b3b8; cursor: pointer; transition: .2s; font-size: 14px; font-weight: 600; }
    .composer-btn:hover { background: #3a3b3c; }
    .post-btn { background: #1877f2; color: #fff; border: none; border-radius: 6px; padding: 8px 20px; font-weight: 600; cursor: pointer; transition: .2s; min-width: 80px; }
    .post-btn:hover { background: #166fe5; }
    .post-btn:disabled { background: #4a4a4a; cursor: not-allowed; }

    /* Posts */
    .post { margin-bottom: 20px; }
    .post-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .post-author-info { display: flex; align-items: center; gap: 8px; }
    .post-author { font-weight: 600; color: #e4e6ea; }
    .post-time { color: #b0b3b8; font-size: 13px; }
    .post-menu { background: none; border: none; color: #b0b3b8; cursor: pointer; padding: 8px; border-radius: 50%; font-size: 16px; }
    .post-menu:hover { background: #3a3b3c; }
    .post-content { margin-bottom: 16px; line-height: 1.4; color: #e4e6ea; font-size: 16px; word-wrap: break-word; }
    .post-stats { display: flex; justify-content: space-between; color: #b0b3b8; font-size: 13px; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #3e4042; }
    .post-actions { display: flex; justify-content: space-around; }
    .post-action { display: flex; align-items: center; gap: 8px; padding: 8px; background: none; border: none; border-radius: 6px; color: #b0b3b8; cursor: pointer; transition: .2s; font-weight: 600; flex: 1; justify-content: center; }
    .post-action:hover { background: #3a3b3c; }
    .post-action.liked { color: #1877f2; }

    /* Right Sidebar */
    .right-sidebar { width: 280px; position: sticky; top: 80px; height: calc(100vh - 80px); overflow-y: auto; }
    .sidebar-section { margin-bottom: 20px; }
    .sidebar-title { font-weight: 600; color: #b0b3b8; margin-bottom: 12px; font-size: 17px; }
    .trending-item { display: flex; align-items: center; padding: 8px; border-radius: 8px; margin-bottom: 4px; cursor: pointer; transition: .2s; }
    .trending-item:hover { background: #3a3b3c; }
    .trending-hash { color: #1877f2; font-weight: 600; margin-right: 8px; }
    .suggested-user { display: flex; align-items: center; justify-content: space-between; padding: 8px; border-radius: 8px; margin-bottom: 8px; transition: .2s; }
    .suggested-user:hover { background: #3a3b3c; }
    .suggested-info { display: flex; align-items: center; gap: 8px; }
    .suggested-name { font-weight: 600; color: #e4e6ea; }
    .suggested-field { color: #b0b3b8; font-size: 13px; }
    .follow-btn { background: #1877f2; color: #fff; border: none; border-radius: 6px; padding: 6px 16px; font-weight: 600; cursor: pointer; font-size: 13px; }
    .follow-btn:hover { background: #166fe5; }

    /* Utility */
    .hidden { display: none !important; }

    /* Notification */
    .notification { position: fixed; top: 80px; right: 20px; background: #1877f2; color: #fff; padding: 12px 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,.3); z-index: 1500; opacity: 0; transform: translateX(100%); transition: .3s ease; }
    .notification.show { opacity: 1; transform: translateX(0); }
    .notification.error { background: #e74c3c; }

    /* Status indicator */
    .status { position: fixed; bottom: 20px; right: 20px; padding: 8px 12px; border-radius: 6px; font-size: 13px; font-weight: 600; z-index: 1500; }
    .status.online { background: rgba(46,160,67,.2); color: #2ea043; border: 1px solid #2ea043; }
    .status.offline { background: rgba(244,67,54,.2); color: #f44336; border: 1px solid #f44336; }

    /* Comments */
    .comments { margin-top: 12px; border-top: 1px solid #3e4042; padding-top: 10px; }
    .comment-item { display: flex; gap: 8px; margin-bottom: 8px; }
    .comment-avatar { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; }
    .comment-body { background: #202223; padding: 8px 10px; border-radius: 10px; max-width: 100%; font-size: 14px; }
    .comment-meta { color: #9aa0a6; font-size: 12px; margin-top: 4px; }
    .comment-form { display: flex; gap: 8px; margin-top: 8px; }
    .comment-input { flex: 1; background: #2b2d2f; border: 1px solid #3e4042; color: #e4e6ea; border-radius: 16px; padding: 8px 12px; font-size: 14px; }
    .comment-btn { background: #1877f2; border: none; color: #fff; padding: 8px 12px; border-radius: 12px; cursor: pointer; font-weight: 600; }
    .comment-btn:disabled { background: #4a4a4a; cursor: not-allowed; }
    .delete-comment { background: transparent; border: none; color: #9aa0a6; cursor: pointer; font-size: 12px; margin-left: 8px; }
    .delete-comment:hover { color: #e74c3c; }

    @media (max-width: 1024px) { .left-sidebar, .right-sidebar { display: none; } .main-feed { max-width: none; } }
    @media (max-width: 768px) { .search-bar { display: none; } .main-container { padding: 20px 8px; } .login-content { width: 95%; padding: 24px; } }
  </style>
</head>
<body>
  <!-- Login Modal -->
  <div id="loginModal" class="login-modal">
    <div class="login-content">
      <button class="modal-close" onclick="closeModal()">&times;</button>
      <div class="login-header">
        <div class="login-logo">🧠 DeepNet Social</div>
        <div class="login-subtitle">Connect with AI researchers worldwide</div>
      </div>
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
        <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
      </div>
      <form id="loginForm" class="auth-form">
        <div class="form-group"><input type="email" class="form-input" name="email" placeholder="Email address" required></div>
        <div class="form-group"><input type="password" class="form-input" name="password" placeholder="Password" required></div>
        <button type="submit" class="auth-btn">Log In</button>
        <div id="loginMessage" class="auth-message"></div>
      </form>
      <form id="signupForm" class="auth-form hidden">
        <div class="form-group"><input type="email" class="form-input" name="email" placeholder="Email address" required></div>
        <div class="form-group"><input type="password" class="form-input" name="password" placeholder="Create password" minlength="6" required></div>
        <button type="submit" class="auth-btn">Sign Up</button>
        <div id="signupMessage" class="auth-message"></div>
      </form>
    </div>
  </div>

  <!-- Notification & Status -->
  <div id="notification" class="notification"></div>
  <div id="status" class="status offline">🔄 Initializing...</div>

  <!-- Main App -->
  <div id="app" class="hidden">
    <header class="header">
      <div class="header-content">
        <a href="#" class="logo"><span>🧠</span>DeepNet Social</a>
        <div class="search-bar"><input type="text" class="search-input" placeholder="Search DeepNet Social"></div>
        <nav class="header-nav">
          <a href="#" class="nav-item active">Home</a>
          <a href="#" class="nav-item">Research</a>
          <a href="#" class="nav-item">Communities</a>
          <a href="#" class="nav-item">Messages</a>
        </nav>
        <div class="header-actions">
          <button class="icon-btn">🔔</button>
          <button class="icon-btn">💬</button>
          <img id="userAvatar" src="https://i.pravatar.cc/40?u=guest" class="user-avatar" alt="User Avatar">
          <button class="logout-btn" onclick="logoutUser()">Logout</button>
        </div>
      </div>
    </header>

    <div class="main-container">
      <aside class="left-sidebar">
        <a href="#" class="sidebar-item">
          <img id="sidebarAvatar" src="https://i.pravatar.cc/40?u=guest" class="sidebar-icon" style="border-radius: 50%;" alt="Profile">
          <span class="sidebar-text" id="profileName">Your Profile</span>
        </a>
        <a href="#" class="sidebar-item"><div class="sidebar-icon">👥</div><span class="sidebar-text">AI Communities</span></a>
        <a href="#" class="sidebar-item"><div class="sidebar-icon">📊</div><span class="sidebar-text">Research Analytics</span></a>
        <a href="#" class="sidebar-item"><div class="sidebar-icon">📚</div><span class="sidebar-text">Papers & Publications</span></a>
        <a href="#" class="sidebar-item"><div class="sidebar-icon">🔖</div><span class="sidebar-text">Saved Posts</span></a>
        <a href="#" class="sidebar-item"><div class="sidebar-icon">⚙️</div><span class="sidebar-text">Settings</span></a>
      </aside>

      <main class="main-feed">
        <div class="card post-composer">
          <div class="composer-header">
            <img id="composerAvatar" src="https://i.pravatar.cc/40?u=guest" class="user-avatar" alt="Your Avatar">
            <textarea class="composer-input" id="postInput" placeholder="Share your research insights with the AI community..." rows="3"></textarea>
          </div>
          <div class="composer-tools">
            <div class="composer-options">
              <button class="composer-btn">📝 Text</button>
              <button class="composer-btn">💻 Code</button>
              <button class="composer-btn">📄 Paper</button>
              <button class="composer-btn">📊 Poll</button>
            </div>
            <button class="post-btn" id="postButton" onclick="createPost()">Post</button>
          </div>
        </div>

        <div id="postsContainer"></div>
      </main>

      <aside class="right-sidebar">
        <div class="sidebar-section">
          <h3 class="sidebar-title">Trending in AI</h3>
          <div class="trending-item"><span class="trending-hash">#</span><span>MachineLearning</span></div>
          <div class="trending-item"><span class="trending-hash">#</span><span>NeurIPS2025</span></div>
          <div class="trending-item"><span class="trending-hash">#</span><span>ComputerVision</span></div>
          <div class="trending-item"><span class="trending-hash">#</span><span>NLP</span></div>
          <div class="trending-item"><span class="trending-hash">#</span><span>DeepLearning</span></div>
        </div>
        <div class="sidebar-section">
          <h3 class="sidebar-title">Suggested Connections</h3>
          <div class="suggested-user">
            <div class="suggested-info">
              <img src="https://i.pravatar.cc/40?u=john" class="user-avatar" alt="Dr. John Smith">
              <div><div class="suggested-name">Dr. John Smith</div><div class="suggested-field">Computer Vision</div></div>
            </div>
            <button class="follow-btn">Follow</button>
          </div>
          <div class="suggested-user">
            <div class="suggested-info">
              <img src="https://i.pravatar.cc/40?u=lisa" class="user-avatar" alt="Prof. Lisa Wang">
              <div><div class="suggested-name">Prof. Lisa Wang</div><div class="suggested-field">NLP Research</div></div>
            </div>
            <button class="follow-btn">Follow</button>
          </div>
        </div>
        <div class="sidebar-section">
          <h3 class="sidebar-title">Upcoming Events</h3>
          <div class="trending-item"><div><div style="font-weight: 600;">NeurIPS 2025</div><div style="color: #b0b3b8; font-size: 13px;">Dec 10-16, Vancouver</div></div></div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Firebase Authentication Only + Local Posts/Comments -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBytov9p2TGFudvnwQZ1hSi5f9oXaSKDAQ",
      authDomain: "deepnet-social-backend.firebaseapp.com",
      projectId: "deepnet-social-backend",
      storageBucket: "deepnet-social-backend.firebasestorage.app",
      messagingSenderId: "689173633913",
      appId: "1:689173633913:web:b5290dc64ea8fd2b2f2da8",
      measurementId: "G-B1ENWRY6JK"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // UI references
    const loginModal = document.getElementById('loginModal');
    const appDiv = document.getElementById('app');
    const userAvatar = document.getElementById('userAvatar');
    const sidebarAvatar = document.getElementById('sidebarAvatar');
    const composerAvatar = document.getElementById('composerAvatar');
    const profileName = document.getElementById('profileName');
    const notification = document.getElementById('notification');
    const status = document.getElementById('status');
    const postsContainer = document.getElementById('postsContainer');

    const STORAGE_KEY = 'deepnet_posts_v2';

    // Utility
    function showNotification(message, type='success') {
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');
      setTimeout(()=>notification.classList.remove('show'), 3000);
    }
    function updateStatus(message, type='online') {
      status.textContent = message;
      status.className = `status ${type}`;
    }
    function formatTime(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diff = now - date;
      if (diff < 60000) return 'Just now';
      if (diff < 3600000) return `${Math.floor(diff/60000)}m ago`;
      if (diff < 86400000) return `${Math.floor(diff/3600000)}h ago`;
      if (diff < 604800000) return `${Math.floor(diff/86400000)}d ago`;
      return date.toLocaleDateString();
    }
    function getPosts(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); } catch { return []; } }
    function setPosts(p){ localStorage.setItem(STORAGE_KEY, JSON.stringify(p)); }

    // Rendering
    function createPostElement(post){
      const postDiv = document.createElement('div');
      postDiv.className = 'card post';
      postDiv.dataset.postId = post.id;

      const isLiked = post.likedBy && post.likedBy.includes(auth.currentUser?.uid);
      const commentCount = post.commentList?.length || 0;

      postDiv.innerHTML = `
        <div class="post-header">
          <div class="post-author-info">
            <img src="${post.authorAvatar}" class="user-avatar" alt="${post.authorName}" onerror="this.src='https://i.pravatar.cc/40?u=default'">
            <div>
              <div class="post-author">${post.authorName}</div>
              <div class="post-time">${formatTime(post.createdAt)}</div>
            </div>
          </div>
          <button class="post-menu" onclick="postMenu('${post.id}')">⋯</button>
        </div>
        <div class="post-content">${post.content.replace(/\n/g,'<br>')}</div>
        <div class="post-stats">
          <span>${post.likes||0} reactions • <span class="comment-count">${commentCount}</span> comments</span>
          <span>0 shares</span>
        </div>
        <div class="post-actions">
          <button class="post-action ${isLiked ? 'liked':''}" onclick="toggleLike('${post.id}')"><span>👍</span><span>Like</span></button>
          <button class="post-action" onclick="focusCommentInput('${post.id}')"><span>💬</span><span>Comment</span></button>
          <button class="post-action" onclick="sharePost('${post.id}')"><span>↗️</span><span>Share</span></button>
        </div>
        <div class="comments">
          <div class="comment-list"></div>
          <div class="comment-form">
            <input type="text" class="comment-input" placeholder="Write a comment..." onkeydown="commentKeydown(event,'${post.id}')">
            <button class="comment-btn" onclick="addComment('${post.id}')">Post</button>
          </div>
        </div>
      `;
      renderComments(postDiv, post);
      return postDiv;
    }
    function renderComments(postEl, post){
      const listEl = postEl.querySelector('.comment-list');
      listEl.innerHTML = '';
      (post.commentList||[]).forEach((c, idx)=>{
        const item = document.createElement('div');
        item.className = 'comment-item';
        item.innerHTML = `
          <img src="${c.avatar}" class="comment-avatar" alt="${c.author}" onerror="this.src='https://i.pravatar.cc/28?u=default'">
          <div>
            <div class="comment-body"><strong>${c.author}</strong><br>${c.text.replace(/\n/g,'<br>')}</div>
            <div class="comment-meta">
              ${formatTime(c.createdAt)}
              ${auth.currentUser && auth.currentUser.uid===c.userId ? `<button class="delete-comment" onclick="deleteComment('${post.id}',${idx})">Delete</button>`:''}
            </div>
          </div>
        `;
        listEl.appendChild(item);
      });
    }
    function displayPosts(){
      const posts = getPosts();
      postsContainer.innerHTML = '';
      if(posts.length===0){
        postsContainer.innerHTML = `
          <div class="card" style="text-align:center; padding:40px;">
            <h3 style="color:#8b949e; margin-bottom:8px;">Welcome to DeepNet Social! 🎉</h3>
            <p style="color:#8b949e; font-size:14px;">Share your research insights and connect with the AI community!</p>
          </div>`;
        updateStatus('📚 Ready to post','online');
        return;
      }
      posts.forEach(p=>postsContainer.appendChild(createPostElement(p)));
      updateStatus(\`📡 Online • \${posts.length} posts loaded\`,'online');
    }

    // Global interactions
    window.switchAuthTab = function(tab){
      const loginForm=document.getElementById('loginForm');
      const signupForm=document.getElementById('signupForm');
      const tabs=document.querySelectorAll('.auth-tab');
      tabs.forEach(t=>t.classList.remove('active'));
      if(tab==='login'){ loginForm.classList.remove('hidden'); signupForm.classList.add('hidden'); tabs[0].classList.add('active'); }
      else { loginForm.classList.add('hidden'); signupForm.classList.remove('hidden'); tabs[1].classList.add('active'); }
    };
    window.closeModal = function(){ loginModal.classList.add('hidden'); };
    window.logoutUser = async function(){ try{ await signOut(auth); showNotification('Logged out successfully!'); }catch(e){ showNotification('Logout failed: '+e.message,'error'); } };

    window.createPost = function(){
      const postInput = document.getElementById('postInput');
      const postButton = document.getElementById('postButton');
      const content = postInput.value.trim();
      if(!content){ showNotification('Please enter some content for your post!','error'); return; }
      if(!auth.currentUser){ showNotification('Please log in to create a post!','error'); return; }
      postButton.disabled = true; postButton.textContent='Posting...';
      try{
        const user=auth.currentUser;
        const avatar=user.photoURL || \`https://i.pravatar.cc/40?u=\${user.uid}\`;
        const name=user.displayName || user.email.split('@')[0];
        const newPost = {
          id: Date.now().toString(),
          content,
          authorId: user.uid,
          authorName: name,
          authorEmail: user.email,
          authorAvatar: avatar,
          createdAt: new Date().toISOString(),
          likes: 0,
          comments: 0,
          likedBy: [],
          commentList: []
        };
        const posts=getPosts(); posts.unshift(newPost); setPosts(posts);
        displayPosts();
        postInput.value='';
        showNotification('Post created successfully! 🎉');
      }catch(e){ console.error(e); showNotification('Failed to create post: '+e.message,'error'); }
      finally{ postButton.disabled=false; postButton.textContent='Post'; }
    };

    window.toggleLike = function(postId){
      if(!auth.currentUser){ showNotification('Please log in to like posts!','error'); return; }
      const posts=getPosts();
      const idx=posts.findIndex(p=>p.id===postId);
      if(idx===-1) return;
      const uid=auth.currentUser.uid;
      posts[idx].likedBy=posts[idx].likedBy||[];
      if(posts[idx].likedBy.includes(uid)){ posts[idx].likedBy=posts[idx].likedBy.filter(x=>x!==uid); posts[idx].likes=Math.max(0,(posts[idx].likes||0)-1); showNotification('Post unliked'); }
      else { posts[idx].likedBy.push(uid); posts[idx].likes=(posts[idx].likes||0)+1; showNotification('Post liked! 👍'); }
      setPosts(posts); displayPosts();
    };

    window.postMenu = function(postId){
      if(confirm('Delete this post?')){
        const posts=getPosts().filter(p=>p.id!==postId);
        setPosts(posts); displayPosts(); showNotification('Post deleted!');
      }
    };
    window.sharePost = function(){ showNotification('Post shared! 🔄'); };
    window.focusCommentInput = function(postId){ const postEl=document.querySelector(\`[data-post-id="\${postId}"]\`); postEl?.querySelector('.comment-input')?.focus(); };
    window.commentKeydown = function(e, postId){ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); addComment(postId); } };

    window.addComment = function(postId){
      if(!auth.currentUser){ showNotification('Please log in to comment!','error'); return; }
      const postEl=document.querySelector(\`[data-post-id="\${postId}"]\`); if(!postEl) return;
      const input=postEl.querySelector('.comment-input'); const text=input.value.trim(); if(!text) return;
      const user=auth.currentUser;
      const comment={ userId:user.uid, author:user.displayName||user.email.split('@')[0], avatar:user.photoURL||\`https://i.pravatar.cc/28?u=\${user.uid}\`, text, createdAt:new Date().toISOString() };
      const posts=getPosts(); const idx=posts.findIndex(p=>p.id===postId); if(idx===-1) return;
      posts[idx].commentList=posts[idx].commentList||[]; posts[idx].commentList.push(comment); posts[idx].comments=posts[idx].commentList.length; setPosts(posts);
      renderComments(postEl, posts[idx]); const countEl=postEl.querySelector('.comment-count'); if(countEl) countEl.textContent=posts[idx].comments;
      input.value=''; showNotification('Comment posted! 💬');
    };

    window.deleteComment = function(postId, commentIndex){
      const posts=getPosts(); const idx=posts.findIndex(p=>p.id===postId); if(idx===-1) return;
      const c=posts[idx].commentList?.[commentIndex]; if(!c) return;
      if(!auth.currentUser || auth.currentUser.uid!==c.userId){ showNotification('Only the author can delete this comment','error'); return; }
      posts[idx].commentList.splice(commentIndex,1); posts[idx].comments=posts[idx].commentList.length; setPosts(posts);
      const postEl=document.querySelector(\`[data-post-id="\${postId}"]\`); if(postEl){ renderComments(postEl, posts[idx]); const countEl=postEl.querySelector('.comment-count'); if(countEl) countEl.textContent=posts[idx].comments; }
      showNotification('Comment deleted');
    };

    // Auth forms
    document.getElementById('signupForm').addEventListener('submit', async (e)=>{
      e.preventDefault(); const email=e.target.email.value; const password=e.target.password.value; const msg=document.getElementById('signupMessage');
      try{ await createUserWithEmailAndPassword(auth,email,password); msg.className='auth-message success'; msg.textContent='✅ Account created successfully!'; e.target.reset(); setTimeout(()=>loginModal.classList.add('hidden'), 800); }
      catch(err){ msg.className='auth-message error'; msg.textContent='❌ '+err.message; }
    });
    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault(); const email=e.target.email.value; const password=e.target.password.value; const msg=document.getElementById('loginMessage');
      try{ await signInWithEmailAndPassword(auth,email,password); msg.className='auth-message success'; msg.textContent='✅ Login successful!'; e.target.reset(); setTimeout(()=>loginModal.classList.add('hidden'), 800); }
      catch(err){ msg.className='auth-message error'; msg.textContent='❌ '+err.message; }
    });

    // Auth state
    onAuthStateChanged(auth,(user)=>{
      if(user){
        loginModal.classList.add('hidden'); appDiv.classList.remove('hidden');
        const avatar=user.photoURL||\`https://i.pravatar.cc/40?u=\${user.uid}\`; const name=user.displayName||user.email.split('@')[0];
        userAvatar.src=avatar; sidebarAvatar.src=avatar; composerAvatar.src=avatar; profileName.textContent=name;
        displayPosts(); updateStatus('✅ Logged in','online');
      } else {
        loginModal.classList.remove('hidden'); appDiv.classList.add('hidden');
        const guest='https://i.pravatar.cc/40?u=guest'; userAvatar.src=guest; sidebarAvatar.src=guest; composerAvatar.src=guest; profileName.textContent='Your Profile';
        updateStatus('🔄 Please log in','offline');
      }
    });

    console.log('🧠 DeepNet Social — Local posts + inline comments loaded!');
  </script>
</body>
</html>
